<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9.1: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Refactoring: An Introduction</title>
<meta name="authors" content="Wayne Witzel III" />
<meta name="date" content="SourceForge Cont. Ed. (2012/09/14)" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7434 2012-05-11 21:06:27Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { /* line numbers */
  color: grey;
}

.code {
  background-color: #eeeeee
}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/pretty/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/pretty/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/pretty/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/pretty/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/pretty/opera.css"
      type="text/css" media="projection" id="operaFix" />

<style type="text/css">
#currentSlide {display: none;}
</style>
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>Refactoring: An Introduction</h1>
<h2>Wayne Witzel III &lt;<a class="reference external" href="mailto:wwitzel&#64;geek.net">wwitzel&#64;geek.net</a>&gt;</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">Refactoring: An Introduction</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Authors:</th>
<td>Wayne Witzel III</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>SourceForge Cont. Ed. (2012/09/14)</td></tr>
</tbody>
</table>
<!-- Definitions of interpreted text roles (classes) for S5/HTML data. -->
<!-- This data file has been placed in the public domain. -->
<!-- Colours
======= -->
<!-- Text Sizes
========== -->
<!-- Display in Slides (Presentation Mode) Only
========================================== -->
<!-- Display in Outline Mode Only
============================ -->
<!-- Display in Print Only
===================== -->
<!-- Display in Handout Mode Only
============================ -->
<!-- Incremental Display
=================== -->

</div>
<div class="slide" id="the-refactoring-bible">
<h1>The Refactoring Bible</h1>
<ul class="simple">
<li>Refactoring: Improving the Design of Existing Code
(Fowler, Beck, Brant, Opdyke, Roberts)</li>
<li>Use your training budget to get this book. Read it. You will be better
programmer for it.</li>
</ul>
</div>
<div class="slide" id="terminology">
<h1>Terminology</h1>
<ul class="simple">
<li>Refactoring. Modifying existing code in such a way to make it better. Better
can have a lot of meanings and is subjective to the situation, but you know
if you've made the code better or not.</li>
<li>Smell. Any code that follows a pattern that makes it stink. We will talk
about the most common ones from sfpy.</li>
</ul>
</div>
<div class="slide" id="common-smell-duplicated-code">
<h1>Common Smell: Duplicated Code</h1>
<ul class="simple">
<li>This is the worst offender and easiest to spot and usually the easiest
to resolve. Just use Extract Method and call the new method in both places.</li>
<li>Extract Method: You have code fragments that can be grouped. Turn the
fragment in to a method whose name explains the purpose of the method.</li>
</ul>
</div>
<div class="slide" id="duplicated-code-example">
<h1>Duplicated Code: Example</h1>
<blockquote>
<div class="highlight"><pre><span class="n">facet_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facets</span><span class="p">]</span>
<span class="c"># and in other methods ..</span>
<span class="n">facet_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facets</span><span class="p">]</span>
<span class="c"># and in another method .. you get the idea</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">facet_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facets</span><span class="p">]</span>
</pre></div>
</blockquote>
<ul class="simple">
<li>Eventually this will help you reduce duplicated code, but be warned, this
type of refactoring can commonly lead to Large Class (we cover that later).</li>
</ul>
</div>
<div class="slide" id="common-smell-long-method">
<h1>Common Smell: Long Method</h1>
<ul class="simple">
<li>Programs that live the best and longest lives are those with short methods.
The longer a procedure is, the harder it is to understand and therefore
modify.</li>
<li>Extract Method, previously shown, is a great way to solve most long method
smells.</li>
</ul>
</div>
<div class="slide" id="long-method-example-1">
<h1>Long Method: Example 1</h1>
<blockquote>
<div class="highlight"><pre> <span class="k">if</span> <span class="n">del_filter</span><span class="o">.</span><span class="n">facet</span><span class="o">.</span><span class="n">_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;os&#39;</span><span class="p">,</span> <span class="s">&#39;freshness&#39;</span><span class="p">]:</span>
    <span class="n">os</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">current_os</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">del_filter</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">os</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;directory_ignore_os&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
    <span class="k">elif</span> <span class="n">del_filter</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;Recently updated&#39;</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;directory_ignore_freshness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># instead of having this inline, it gets replaced with method call</span>

<span class="bp">self</span><span class="o">.</span><span class="n">_update_global_filters</span><span class="p">(</span><span class="n">del_filter</span><span class="p">)</span>
</pre></div>
</blockquote>
<ul class="simple">
<li>If we do this for our logic blocks, we end up having a lot of short, self
documented methods doing our work, which is much easier to maintain.</li>
</ul>
</div>
<div class="slide" id="common-smells-long-method-part-ii">
<h1>Common Smells: Long Method - part II</h1>
<ul class="simple">
<li>If your method has a lot of parameters and temporary values, which
in sfpy, we tend to have a lot of, then another approach is needed.</li>
</ul>
</div>
<div class="slide" id="long-method-example-1-1">
<h1>Long Method: Example 1.1</h1>
<ul>
<li><p class="first">Replace Temp with Query: Extract the temporary expression into a method. Now
this information is available beyond the local scope of the method in
question and that makes it easier to come up with cleaner code for the class</p>
<div class="highlight"><pre><span class="n">breadcrumbs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Home&quot;</span><span class="p">),</span>
               <span class="nb">dict</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory_root</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Browse&quot;</span><span class="p">)]</span>
<span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">breadcrumbs</span><span class="o">=</span><span class="n">breadcrumbs</span><span class="p">)</span>

<span class="c"># extract and replace, now return looks like this</span>
<span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">breadcrumbs</span><span class="o">=</span><span class="n">breadcrumbs</span><span class="p">())</span>
</pre></div>
</li>
</ul>
</div>
<div class="slide" id="long-method-example-1-2">
<h1>Long Method: Example 1.2</h1>
<ul>
<li><p class="first">Replace Parameter with Method: Remove the parameter and let the receiver
invoke the method. The general rule here is that if a method can get a
parameter through other means, it should.</p>
<div class="highlight"><pre><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">filtered_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c"># now combine replace temp with replace parameters</span>
<span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">params</span><span class="p">())</span>
<span class="n">filtered_results</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">()</span>
</pre></div>
</li>
</ul>
</div>
<div class="slide" id="common-smell-large-class">
<h1>Common Smell: Large Class</h1>
<ul class="simple">
<li>Classes should have clear responsibilities. We find ourselves, usually in
small doses, adding new responsbilities to existing classes that just aren't
worth creating a whole new class for.</li>
<li>End result, you have a class doing too many things. This is hard to maintain
and leads to more errors, more developer time, and causes other smells like
Shotgun Surgery.</li>
<li>Fortunately fixing this problem is usually as easy as applying Extract Class.
Decide how to split the class, rename old class (if needed), move any methods
and create the link to the new class.</li>
<li>Easy way to spot this smell is if you have many class variables named:
responsibility_variable.</li>
</ul>
</div>
<div class="slide" id="large-class-example">
<h1>Large Class: Example</h1>
<blockquote>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shortname</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">release_metadata</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">release_files</span>

<span class="c"># extract class</span>

<span class="k">class</span> <span class="nc">Release</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">files</span>

<span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shortname</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">Release</span><span class="p">()</span>
</pre></div>
</blockquote>
</div>
<div class="slide" id="common-smell-shotgun-surgery">
<h1>Common Smell: Shotgun Surgery</h1>
<ul class="simple">
<li>You smell this one anytime you make a change that results in you having to
make a lot of little changes everywhere.</li>
<li>This is error prone and often leads to missed code changes that come back to
bit you in the ass.</li>
<li>The good news is this is another one that is pretty easy to resolve. We can
use Move Method and Move Field to take all the pain away.</li>
</ul>
</div>
<div class="slide" id="shotgun-surgery-example-class">
<h1>Shotgun Surgery: Example Class</h1>
<blockquote>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">featured</span> <span class="o">=</span>  <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ReviewType</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">calculate_stuff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;StarAndRecommended&#39;</span><span class="p">:</span>
            <span class="c"># do This</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">def</span> <span class="nf">is_featured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">featured</span>
</pre></div>
</blockquote>
<ul class="simple">
<li>Here is a common example of code you will see a lof of in sfpy.</li>
<li>If we want to display things differently based on information in the
ReviewType, we should really move this to the ReviewType class.</li>
</ul>
</div>
<div class="slide" id="shotgun-surgery-move-method-example">
<h1>Shotgun Surgery: Move Method Example</h1>
<blockquote>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ReviewType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">calculate_stuff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;StarAndRecommend&#39;</span><span class="p">:</span>
            <span class="c"># do Stuff</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># do This</span>
        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">calculate_stuff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">calculate_stuff</span><span class="p">()</span>
</pre></div>
</blockquote>
<ul class="simple">
<li>We preserve the interface of Review while cleaning it up and reducing the
the tight coupling to ReviewType.</li>
</ul>
</div>
<div class="slide" id="shotgun-surgery-move-field-example">
<h1>Shotgun Surgery: Move Field Example</h1>
<ul>
<li><p class="first">We decided we also want ReviewTypes as a whole to be featured, not the
indivual reviews themselves.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ReviewType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">featured</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">is_featured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">featured</span>
</pre></div>
</li>
</ul>
</div>
<div class="slide" id="stuff-that-just-isn-t-true">
<h1>Stuff That Just Isn't True</h1>
<ul class="simple">
<li>Refactoring makes your code slower.</li>
<li>It isn't worth the time to refactor.</li>
<li>Ruby is a good programming language.</li>
</ul>
</div>
<div class="slide" id="questions">
<h1>Questions</h1>
<ul class="simple">
<li>That's all folks.</li>
</ul>
</div>
</div>
</body>
</html>
