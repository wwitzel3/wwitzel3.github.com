<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9.1: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Freelance Consulting Story</title>
<meta name="authors" content="Wayne Witzel III  NakedTech LLC" />
<meta name="date" content="01 Jan 1970" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7434 2012-05-11 21:06:27Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { /* line numbers */
  color: grey;
}

.code {
  background-color: #eeeeee
}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/pretty/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/pretty/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/pretty/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/pretty/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/pretty/opera.css"
      type="text/css" media="projection" id="operaFix" />

<style type="text/css">
#currentSlide {display: none;}
</style>
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>Freelance Consulting Story</h1>
<h2>Wayne Witzel III, NakedTech LLC</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">Freelance Consulting Story</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Authors:</th>
<td>Wayne Witzel III
<br />NakedTech LLC</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>01 Jan 1970</td></tr>
</tbody>
</table>
<!-- Definitions of interpreted text roles (classes) for S5/HTML data. -->
<!-- This data file has been placed in the public domain. -->
<!-- Colours
======= -->
<!-- Text Sizes
========== -->
<!-- Display in Slides (Presentation Mode) Only
========================================== -->
<!-- Display in Outline Mode Only
============================ -->
<!-- Display in Print Only
===================== -->
<!-- Display in Handout Mode Only
============================ -->
<!-- Incremental Display
=================== -->

</div>
<div class="slide" id="who-am-i">
<h1>Who Am I</h1>
<ul class="simple">
<li>Python developer, currently working for Geek.net on their SourceForge
platform.</li>
<li>A former consultant, at one time, working with 10 different clients
including Geek.net, CBS Interactive, Rackspace, Lionbridge, and CKAN.</li>
<li>I do my best to try and give back to the OSS community through very minor
contributions to SQLalchemy, Pyramid, and the Pylons project.</li>
</ul>
</div>
<div class="slide" id="how-this-all-started">
<h1>How This All Started</h1>
<ul class="simple">
<li>Disenfranchised with my current job.</li>
<li>Control what I worked on.</li>
</ul>
</div>
<div class="slide" id="quiting-my-day-job">
<h1>Quiting My Day Job</h1>
<ul class="simple">
<li>Health Insurance</li>
<li>Hardware and Software</li>
<li>Paid Time Off / Sick Leave</li>
<li>401K</li>
</ul>
</div>
<div class="slide" id="moar-work">
<h1>Moar Work!</h1>
<ul class="simple">
<li>Library: maintains none or little of its own state, no or few callbacks.</li>
<li>Framework: no or little state, but lots of callbacks.  Some frameworks
mutate or require global state (IMO inappropriately).  A web framework
instance is often fed to a global mainloop, but that doesn't mean it should
use globals with abandon.  Even then if the framework doesn't use global
state, with a little care, two framework instances can live in the same
process.</li>
<li>Application: maintains lots of state, can use global state with abandon.</li>
</ul>
</div>
<div class="slide" id="tight-rope-work-life-balance">
<h1>Tight Rope: Work Life Balance</h1>
<ul class="simple">
<li>The assumption: &quot;clean&quot; == &quot;is maximally convenient for the case I presume
this code is going to be used in&quot;</li>
<li>The reality:  &quot;clean&quot; == &quot;maximally understandable; without surprises or
exceptions&quot;.</li>
<li>The fewer limiting assumptions made by the library, the fewer surprises it
will have and the more understandable it will be.</li>
<li>Ex: thread-local state management doesn't work in async systems without
magical intervention.</li>
</ul>
</div>
<div class="slide" id="i-care-about-your-feelings">
<h1>I Care About Your Feelings</h1>
<ul class="simple">
<li>During this talk, I call out antipattern examples from actual projects
(including my own).</li>
<li>If I use code from one of your projects as an antipattern example, it
doesn't mean I don't like you.</li>
<li>This talk is impossible to give without showing negative examples.  I'm
lazy and the best negative examples are those that already exist.</li>
</ul>
</div>
<div class="slide" id="global-state-is-precious">
<h1>#1: Global State is Precious</h1>
<ul class="simple">
<li>Avoid the mutation of global (module-level) state when your library is
imported.</li>
<li>Avoid requiring that other people mutate global state to use your library.
Ex: telling people to set an environment variable or call a function
which mutates global state to use your library</li>
<li>If your library mutates global state when it's imported or you tell people
to mutate global state to use it, it's not really a library, it's kinda
more like an application.</li>
</ul>
</div>
<div class="slide" id="ok-at-module-scope">
<h1>OK at Module Scope</h1>
<ul class="simple">
<li>An import of another module or global.</li>
<li>Assignment of a variable name in the module to some constant value.</li>
<li>The addition of a function via a def statement.</li>
<li>The addition of a class via a class statement.</li>
<li>Control flow which may handles conditionals for platform-specific handling
or failure handling of the above.</li>
<li>Anything else will usually end in tears.</li>
</ul>
</div>
<div class="slide" id="antipatterns">
<h1>Antipatterns</h1>
<ul class="simple">
<li>Antipatterns from the Python standard library: <tt class="docutils literal">logging</tt>,
<tt class="docutils literal">multiprocessing</tt>, <tt class="docutils literal">mimetypes</tt>.</li>
</ul>
</div>
<div class="slide" id="atexit-register-during-import">
<h1>atexit Register During Import</h1>
<p>Importing <tt class="docutils literal">multiprocessing</tt> from the standard library causes an atexit
function to be registered at module scope:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">_exit_function</span><span class="p">():</span>
    <span class="c"># ... elided ...</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">active_children</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">_daemonic</span><span class="p">:</span>
            <span class="n">info</span><span class="p">(</span><span class="s">&#39;calling terminate() for daemon </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">_popen</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    <span class="c"># .. elided ...</span>

<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_exit_function</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="atexit-register-during-import-2">
<h1>atexit Register During Import (2)</h1>
<p>From <tt class="docutils literal">logging</tt> module:</p>
<div class="highlight"><pre><span class="n">_handlerList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># mutated by logging.getLogger, etc</span>

<span class="kn">import</span> <span class="nn">atexit</span>

 <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="n">handlerList</span><span class="o">=</span><span class="n">_handlerList</span><span class="p">):</span>
     <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handlerList</span><span class="p">[:]:</span>
        <span class="c"># ...</span>

<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">shutdown</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="why-is-this-bad">
<h1>Why is This Bad?</h1>
<ul class="simple">
<li>It's unexpected.  Registration of an <tt class="docutils literal">atexit</tt> function is a mutation of
global state that results solely from an <em>import</em> of a module, whether or
not you actually use any APIs from the module.  Your program will behave
differently at shutdown if you cause <tt class="docutils literal">multiprocessing</tt> or <tt class="docutils literal">logging</tt> to
be imported, or if you import a third-party module that happens to import
one of them (you might not even know).</li>
<li>It's unnecessary.  both <tt class="docutils literal">multiprocessing</tt> and <tt class="docutils literal">logging</tt> need to manage
global state.  But neither really needs to register an <tt class="docutils literal">atexit</tt> function
until there's any nondefault state to clean up.</li>
</ul>
</div>
<div class="slide" id="why-is-this-bad-cont-d">
<h1>Why Is This Bad (Cont'd)?</h1>
<ul class="simple">
<li>It's convenient until your process shutdown starts spewing errors that you
can't figure out at unit test exit time.  Then it's pretty damn
inconvenient.  Example: seemingly random error message at shutdown time if
you attempt to use the <tt class="docutils literal">logging.Handler</tt> class independent of the rest of
the framework (see next slide).</li>
</ul>
</div>
<div class="slide" id="ctor-globals-mutation">
<h1>Ctor Globals Mutation</h1>
<p>Mutating a global registry as the result of an object constructor (again from
<tt class="docutils literal">logging</tt>).</p>
<div class="highlight"><pre><span class="n">_handlers</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c">#repository of handlers</span>

<span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">Filterer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">NOTSET</span><span class="p">):</span>
        <span class="c"># .. elided code ...</span>
        <span class="n">_handlers</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_handlerList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="c"># .. elided code ..</span>
</pre></div>
</div>
<div class="slide" id="ctor-globals-mutation-2">
<h1>Ctor Globals Mutation (2)</h1>
<p>From <tt class="docutils literal">asyncore</tt> (at least it lets you choose the <tt class="docutils literal">map</tt>):</p>
<div class="highlight"><pre><span class="n">socket_map</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">dispatcher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="n">socket_map</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="nb">map</span>
        <span class="k">if</span> <span class="n">sock</span><span class="p">:</span>
            <span class="c"># .. set_socket mutates the map ...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="what-s-wrong-with-this">
<h1>What's Wrong With This?</h1>
<ul class="simple">
<li>Side effect of globals mutation makes out-of-context reuse of the class
more difficult than necessary.</li>
<li>You can't make an instance without mutating global state.</li>
<li>If you really must do this, create an alternative &quot;application&quot; API for
instance construction which constructs an instance and <em>then</em> mutates a
global, but let the library be just a library.</li>
<li>Makes unit testing hard (need to clean up module global state).</li>
</ul>
</div>
<div class="slide" id="funcs-called-for-side-effects">
<h1>Funcs Called for Side-Effects</h1>
<p>Users of the <tt class="docutils literal">logging</tt> module are encouraged to do this:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">logging</span><span class="o">.</span><span class="n">addLevelName</span><span class="p">(</span><span class="mi">175</span><span class="p">,</span> <span class="s">&#39;OHNOES&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="calls-for-side-effects-2">
<h1>Calls for Side-Effects (2)</h1>
<p><tt class="docutils literal">mimetypes</tt> module maintains a global registry:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s">&#39;text/foo&#39;</span><span class="p">,</span> <span class="s">&#39;.foo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="id1">
<h1>What's Wrong with This?</h1>
<ul class="simple">
<li>The <tt class="docutils literal">logging</tt> and <tt class="docutils literal">mimetypes</tt> APIs encourage users to mutate their
module's global state by exposing APIs that have return values that nobody
cares about (the APIs are called only for side effects).</li>
<li>Introduces responsibility, chronology, and idempotency confusion.  Who is
responsible for calling this?  When should they call it?  Can it be called
more than once?  If it is called more than once, what happens when it's
called the second time?</li>
</ul>
</div>
<div class="slide" id="what-s-wrong-cont-d">
<h1>What's Wrong (Cont'd)</h1>
<ul class="simple">
<li><tt class="docutils literal">logging</tt> maintains a global registry as a dictionary at module scope.
Calling <tt class="docutils literal">basicConfig()</tt> is effectively a structured monkeypatch of
<tt class="docutils literal">logging</tt> module state.  Same for <tt class="docutils literal">addLevelName</tt>.  Logging classes know
about this global state and use it.  The <tt class="docutils literal">mimetypes</tt> module API maintains
a global registry too.  Same deal.</li>
</ul>
</div>
<div class="slide" id="alternatives-to-mutable-globals">
<h1>Alternatives to Mutable Globals</h1>
<ul class="simple">
<li>All of these packages could choose not manage any global (module-scope)
state at all, and encapsulate all state in an instance.  This has
downsides.</li>
<li>Downside for <tt class="docutils literal">multiprocessing</tt>: its API won't match that of
<tt class="docutils literal">threading</tt>.  Downside for <tt class="docutils literal">logging</tt>: streams related to the same
handler might interleave.  Downside for <tt class="docutils literal">mimetypes</tt>: might need to
reparse system mimetype files.</li>
</ul>
</div>
<div class="slide" id="alternatives-cont-d">
<h1>Alternatives (Cont'd)</h1>
<ul class="simple">
<li>In general, however, no globals in <em>library</em> code is the best solution.
You can always create the library code such that it mutates no global
state, but then, as necessary, create a convenience application module/API
which integrates the library stuff and manages global state on behalf of
its users.  This makes the library code reusable, and if someone wants to
build an alternate set of convenience APIs, they can.</li>
</ul>
</div>
<div class="slide" id="quote">
<h1>Quote</h1>
<p>This method of turning your code inside out is the secret to solving what
appear to be hopelessly state-oriented problems in a purely functional
style. Push the statefulness to a higher level and let the caller worry about
it. Keep doing that as much as you can, and you'll end up with the bulk of
the code being purely functional. -- <a class="reference external" href="http://prog21.dadgum.com/131.html">http://prog21.dadgum.com/131.html</a></p>
</div>
<div class="slide" id="module-scope-config">
<h1>#2: Module Scope Config</h1>
<ul class="simple">
<li>Settings at module scope, requiring monkeypatching to change.</li>
<li>Or configuration systems which tell the user to make a Python module
available for the <em>library</em> to import.</li>
</ul>
</div>
<div class="slide" id="id2">
<h1>Antipatterns</h1>
<p><tt class="docutils literal">logging</tt> and Django.</p>
</div>
<div class="slide" id="not-really-configuration">
<h1>Not-Really-Configuration</h1>
<p>From the <tt class="docutils literal">logging</tt> package:</p>
<div class="highlight"><pre><span class="c">#</span>
<span class="c">#raiseExceptions is used to see if exceptions during handling</span>
<span class="c">#should be propagated</span>
<span class="c">#</span>
<span class="n">raiseExceptions</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="slide" id="id3">
<h1>What's Wrong With This?</h1>
<ul class="simple">
<li>Nothing, if it's only for the benefit/convenience of the library developer
himself.</li>
<li>But if it's presence is advertised to users, it's pseudo-configuration;
there's no way to change it without monkeypatching the module.</li>
<li>The setting is global.  No way to use separate settings per process.</li>
</ul>
</div>
<div class="slide" id="inversion-of-config-control">
<h1>Inversion of Config Control</h1>
<p>Django <tt class="docutils literal">settings.py</tt>:</p>
<div class="highlight"><pre><span class="c"># Django settings for mysite project.</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="n">DEBUG</span>

<span class="n">ADMINS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c"># (&#39;Your Name&#39;, &#39;your_email@example.com&#39;),</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="id4">
<h1>What's Wrong With This?</h1>
<ul class="simple">
<li>The library/framework itself wants to import settings from this module.</li>
<li>But the author of the settings code also usually wants to import stuff from
the library/framework.</li>
<li>Extremely high likelihood of circular import problems (framework imports
settings, settings imports framework).</li>
<li>The settings are global.  No way to use separate settings per process.</li>
</ul>
</div>
<div class="slide" id="solutions">
<h1>Solutions</h1>
<ul class="simple">
<li>Suggest non-Python configuration so likelihood of circular import problems
is reduced.  Configuration parsing can be done at startup time, in a
nonglobal place, allowing multiple usages of the library per process.</li>
<li>Purely imperative configuration at process startup time.</li>
</ul>
</div>
<div class="slide" id="avoid-convenience-features">
<h1>#3: Avoid Convenience Features</h1>
<ul class="simple">
<li>Avoid convenience (magical) features such as thread local access until
you've finished creating the inconvenient (nonmagical) version.</li>
<li>Expose the inconvenient version as a set of APIs.</li>
<li>Make the convenience features optional, through a separate set of APIs.</li>
<li>You can always add convenience to a library, you can never remove it.</li>
</ul>
</div>
<div class="slide" id="id5">
<h1>Antipatterns</h1>
<ul class="simple">
<li>Pylons and Flask.</li>
<li>Stacked object proxies / context locals.</li>
</ul>
</div>
<div class="slide" id="pylons-stacked-object-proxies">
<h1>Pylons' Stacked Object Proxies</h1>
<p>Pylons offers importable <tt class="docutils literal">request</tt> and <tt class="docutils literal">response</tt> objects (&quot;stacked
object proxies&quot;):</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylons</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span>
<span class="kn">from</span> <span class="nn">pylons.controllers</span> <span class="kn">import</span> <span class="n">BaseController</span>

<span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">BaseController</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ok&#39;</span><span class="p">):</span>
            <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">&#39;ok&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">&#39;not ok&#39;</span>
        <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<div class="slide" id="flask-s-context-locals">
<h1>Flask's Context Locals</h1>
<p>Flask has the same concept for its <tt class="docutils literal">request</tt>:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valid_login</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">],</span>
                       <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">log_the_user_in</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s">&#39;Invalid username/password&#39;</span>
</pre></div>
</div>
<div class="slide" id="id6">
<h1>What's Wrong With This?</h1>
<ul class="simple">
<li>Things that are not logically global (<tt class="docutils literal">request</tt> and/or <tt class="docutils literal">response</tt>) are
obtained via an import.</li>
<li>Stacked object proxies / context locals are proxy objects that access a
thread-local when asked for an attribute.  Two levels of magic: a proxy and
its retrieval of a concrete threadlocal.  Nonmagical version is hidden away
from you, at least in Pylons (<tt class="docutils literal">request = self._py_object.request</tt>).</li>
<li>Encourages inappropriate coupling of non-web-context code to a web context
(e.g. &quot;model&quot; modules start to <tt class="docutils literal">import request</tt>).</li>
<li>Makes unit testing harder than it needs to be.</li>
</ul>
</div>
<div class="slide" id="instead">
<h1>Instead</h1>
<ul class="simple">
<li>Design a framework so its users receive an argument (e.g. <tt class="docutils literal">request</tt>) and
suggest to them that they pass derivations
(e.g. <tt class="docutils literal"><span class="pre">request.GET['first_name']</span></tt>) around.  It's initially less
convenient for consumers.  It's usually also the right thing to do <em>in
library and framework code</em>.  Remember that people will want to use your
stuff to compose larger systems, and your assumptions about environment may
not fit there.</li>
<li>You can always create an (optional) convenience API that allows your
library's consumers to elide the passing of state, but you can never remove
a &quot;mandatory&quot; convenience feature from a library.</li>
</ul>
</div>
<div class="slide" id="avoid-knobs-on-knobs">
<h1>#4: Avoid Knobs on Knobs</h1>
<ul class="simple">
<li>A &quot;knob&quot; is often a replaceable component in a framework or library.</li>
<li>When that replaceable component itself offers a knob, this is the &quot;knobs on
knobs&quot; pattern.</li>
</ul>
</div>
<div class="slide" id="pyramid-authn-policy">
<h1>Pyramid Authn Policy</h1>
<p>From <tt class="docutils literal">pyramid</tt>, the use of an authentication policy knob on knob:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.authentication</span> <span class="kn">import</span> <span class="n">AuthTktAuthenticationPolicy</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>

<span class="n">GROUPS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fred&#39;</span><span class="p">:[</span><span class="s">&#39;editors&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">groupfinder</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">GROUPS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span>

<span class="n">pol</span> <span class="o">=</span> <span class="n">AuthTktAuthenticationPolicy</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="n">groupfinder</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">set_authentication_policy</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="id7">
<h1>Why Is This Bad?</h1>
<ul class="simple">
<li>We're actually dealing with two separate frameworks.</li>
<li>There's the Pyramid configurator <tt class="docutils literal">set_authentication_policy</tt> method,
which accepts something that adheres to the &quot;authentication policy
interface&quot; (the interface requires a number of methods).
AuthTktAuthenticationPolicy implements this interface.</li>
<li>But AuthTktAuthenticationPolicy is also its own mini-framework, accepting a
<tt class="docutils literal">callback</tt> constructor argument, which must be a callable that accepts a
userid and a request, and which must return a sequence of groups.</li>
</ul>
</div>
<div class="slide" id="id8">
<h1>Why Is This Bad (Cont'd)?</h1>
<ul class="simple">
<li>People don't understand when or why to replace &quot;the big thing&quot; when there's
a &quot;little thing&quot; inside the big thing that's also replaceable.  The choice
introduces indecision and confusion.</li>
<li>This was done with the intent of avoiding documentation that tells people
to subclass AuthTktAuthenticationPolicy, preferring to tell them to compose
something together by passing a callback function to the policy's
constructor.  But telling folks to subclass AuthTktAuthenticationPolicy and
to override e.g. a <tt class="docutils literal">find_groups</tt> method in the subclass would probably be
less confusing and more straightforward in this case.</li>
</ul>
</div>
<div class="slide" id="superclass-danger">
<h1>#5: Superclass Danger</h1>
<ul class="simple">
<li>Offering up superclasses &quot;from on high&quot; in a library or framework is
often a bad idea (although not always).</li>
<li>Composition usually beats inheritance.</li>
</ul>
</div>
<div class="slide" id="the-yo-yo-problem">
<h1>The Yo-Yo Problem</h1>
<ul class="simple">
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Yo-yo_problem">http://en.wikipedia.org/wiki/Yo-yo_problem</a></li>
</ul>
<p>&quot; ... occurs when  a programmer has to read and  understand a program whose
inheritance graph  is so long  and complicated  that the programmer  has to
keep flipping between  many different class definitions in  order to follow
the control flow of the program...&quot;</p>
</div>
<div class="slide" id="yo-yo-problem-cont-d">
<h1>Yo-Yo Problem (Cont'd)</h1>
<p>Almost every Zope object visible from the ZMI inherits from this base class:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span>
           <span class="n">Resource</span><span class="p">,</span>
           <span class="n">CopySource</span><span class="p">,</span>
           <span class="n">Tabs</span><span class="p">,</span>
           <span class="n">Traversable</span><span class="p">,</span>
           <span class="n">Owned</span><span class="p">,</span>
           <span class="n">UndoSupport</span><span class="p">,</span>
           <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A common base class for simple, non-container objects.&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="slide" id="codependency">
<h1>Codependency</h1>
<ul class="simple">
<li>The &quot;specialization interface&quot; of a superclass can be hard to document and
it's very easy to get wrong.</li>
<li>Encapsulation is rarely honored when inheritance is used, so changes to a
parent class will almost always break some number of existing subclasses
whose implementers weren't paying attention to the specialization interface
when they originally inherited from your library's superclass.</li>
</ul>
</div>
<div class="slide" id="codependency-cont-d">
<h1>Codependency (Cont'd)</h1>
<ul class="simple">
<li>The superclass may start simple, initially created to handle one or two
particular cases of reuse via inheritance, but over time, as more folks add
to its specialization interface, it will need to do more delegation, and
may be required to become very abstract.</li>
</ul>
</div>
<div class="slide" id="id9">
<h1>Codependency (Cont'd)</h1>
<ul class="simple">
<li>When the superclass reaches a high level of abstraction, it may not be
obvious what the purpose of the class is or why it's implemented as it is.
A potential maintainer of the superclass may need to gain a detailed
understanding of the implementation of in-the-wild subclasses in order to
change the superclass.  This can scare off potential contributors.</li>
</ul>
</div>
<div class="slide" id="id10">
<h1>Codependency (Cont'd)</h1>
<ul class="simple">
<li>The superclass may assume a particular state outcome from a combination of
method calls.  The expected outcome of such an operation is hard to explain
and difficult for a subclass to enforce.  It may need to change over time,
breaking existing subclasses in hard-to-predict ways.</li>
<li>Subclasses may unknowingly coopt and change the meaning of superclass
instance or class variables.</li>
</ul>
</div>
<div class="slide" id="smells">
<h1>Smells</h1>
<p>From <a class="reference external" href="http://www.midmarsh.co.uk/planetjava/tutorials/design/InheritanceConsideredHarmful.PDF">http://www.midmarsh.co.uk/planetjava/tutorials/design/InheritanceConsideredHarmful.PDF</a></p>
<ul class="simple">
<li>Subclasses which override methods used by other inherited methods (which
are thus reliant on the behaviour and results of the overridden methods).</li>
<li>A subclass which extends inherited methods using <tt class="docutils literal">super</tt>.  Other
inherited methods may rely on the extended method.</li>
</ul>
</div>
<div class="slide" id="smells-cont-d">
<h1>Smells (Cont'd)</h1>
<ul class="simple">
<li>A subclass which relies on or changes the state of &quot;private&quot; instance
variables or which calls or overrides methods that are not part of the
specialization interface.</li>
</ul>
</div>
<div class="slide" id="alternatives-to-inheritance">
<h1>Alternatives to Inheritance</h1>
<ul class="simple">
<li>Composition</li>
<li>Event systems</li>
</ul>
</div>
<div class="slide" id="composition">
<h1>Composition</h1>
<ul class="simple">
<li>Instead of telling folks to override a method of a library superclass via
inheritance, you can tell them to pass in an object to a library class
constructor that represents the custom logic that would have otherwise gone
in a method of a subclass.  The thing they pass to you is a &quot;component&quot;.</li>
<li>The interaction between a component and your library class is
&quot;composition&quot;.</li>
</ul>
</div>
<div class="slide" id="composition-cont-d">
<h1>Composition (Cont'd)</h1>
<ul class="simple">
<li>When a library or framework uses a component, the only dependency between
the library code and the component is the component's interface.  The
library code will only have visibility into the component via its
interface.  The component needn't have any visibility into the library code
at all (but often does).</li>
</ul>
</div>
<div class="slide" id="id11">
<h1>Composition (Cont'd)</h1>
<ul class="simple">
<li>It's less likely that a component author will rely on non-API
implementation details of the library than it would be if he was required
to subclass a library parent class.  The potential distraction of the
ability to customize every aspect of the behavior of the system by
overriding methods is removed.</li>
<li>A clear contract makes it feasible to change the implementation of both the
library and the component with reduced fear of breaking an integration of
the two.</li>
</ul>
</div>
<div class="slide" id="composition-example">
<h1>Composition Example</h1>
<p>Here's an example of providing a class built to be specialized via
inheritance:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TVRemote</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">increment_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>
</div>
<div class="slide" id="composition-example-cont-d">
<h1>Composition Example (Cont'd)</h1>
<p>Here's an example of using the TVRemote class:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">tv</span> <span class="kn">import</span> <span class="n">TVRemote</span>

<span class="k">class</span> <span class="nc">MyRemote</span><span class="p">(</span><span class="n">TVRemote</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="s">&#39;blue&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">increment_channel</span><span class="p">()</span>

<span class="n">remote</span> <span class="o">=</span> <span class="n">MyRemote</span><span class="p">()</span>
<span class="n">remote</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="id12">
<h1>Composition Example (Cont'd)</h1>
<p>Here's an example of a library class built to be specialized via composition
instead of inheritance:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TVRemote</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buttons</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">buttons</span>

    <span class="k">def</span> <span class="nf">increment_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="id13">
<h1>Composition Example (Cont'd)</h1>
<p>Here's an example of someone using the library class we built for
composition:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">tv</span> <span class="kn">import</span> <span class="n">TVRemote</span>

<span class="k">class</span> <span class="nc">Buttons</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="s">&#39;blue&#39;</span><span class="p">:</span>
            <span class="n">remote</span><span class="o">.</span><span class="n">increment_channel</span><span class="p">()</span>

<span class="n">buttons</span> <span class="o">=</span> <span class="n">Buttons</span><span class="p">()</span>
<span class="n">remote</span> <span class="o">=</span> <span class="n">TVRemote</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
<span class="n">remote</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="id14">
<h1>Composition (Cont'd)</h1>
<ul class="simple">
<li>Composition is &quot;take it or leave it&quot; customizability.  It's a good choice
when a problem and interaction is well-defined and well-understood (and, if
you're writing a library for other people to use, this should, by
definition, be true).  But it can be limiting in requirements-sparse
environments where the problem is not yet well-defined or well-understood.</li>
</ul>
</div>
<div class="slide" id="id15">
<h1>Composition (Cont'd)</h1>
<ul class="simple">
<li>It can be easier to use inheritance in a system where you control the
horizontal and vertical while you're working out exactly what the
relationship between objects should be.  If you control the horizontal and
vertical, you can always later switch from inheritance to composition once
the problem is fully understood and people begin to want to reuse your
code.</li>
</ul>
</div>
<div class="slide" id="event-systems">
<h1>Event Systems</h1>
<ul class="simple">
<li>Specialized kind of composition.</li>
<li>For example, instead of adding a <tt class="docutils literal">on_modification</tt> method of a class, and
requiring that people subclass the class to override the method, have the
would-be-superclass send an event to an event system.  The event system can
be subscribed to by system extenders as necessary.</li>
</ul>
</div>
<div class="slide" id="event-systems-cont-d">
<h1>Event Systems (Cont'd)</h1>
<ul class="simple">
<li>This is more flexible than subclassing too, because there's more than one
entry point to extending behavior: an event can be subscribed to by any
number of prospective listeners instead of just one.</li>
<li>Systems reliant on event handling can be a bitch to understand and debug
due to action-at-a-distance.</li>
</ul>
</div>
<div class="slide" id="event-system-example">
<h1>Event System Example</h1>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ButtonPress</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">remote</span> <span class="o">=</span> <span class="n">remote</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">button</span>
<span class="k">class</span> <span class="nc">TVRemote</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_system</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">event_system</span> <span class="o">=</span> <span class="n">event_system</span>
     <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">event_system</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">ButtonPress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">))</span>
<span class="n">event_system</span> <span class="o">=</span> <span class="n">EventSystem</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">subscriber</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="s">&#39;blue&#39;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">increment_channel</span><span class="p">()</span>
<span class="n">event_system</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">ButtonPress</span><span class="p">,</span> <span class="n">subscriber</span><span class="p">)</span>
<span class="n">remote</span> <span class="o">=</span> <span class="n">TVRemote</span><span class="p">(</span><span class="n">event_system</span><span class="p">)</span>
<span class="n">remote</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="when-to-offer-a-superclass">
<h1>When To Offer A Superclass</h1>
<ul class="simple">
<li>When the behavior is absolutely fundamental to the spirit and intent of the
library or framework (e.g. ZODB's <tt class="docutils literal">Persistent</tt>).  Parent classes offered
as slight variations on a theme (e.g. Django class-based views shipped as
niceties) are not fundamental.</li>
<li>A superclass offered by your library should almost always be abstract.
When a user inherits from a concrete parent class, he's usually inheriting
from something that you haven't really designed for specialization, and
it's likely that neither you nor he will be completely clear on what the
specialization interface actually is.  High likelihood for future breakage.</li>
</ul>
</div>
<div class="slide" id="when-to-offer-cont-d">
<h1>When To Offer (Cont'd)</h1>
<ul class="simple">
<li>Not always obvious.  Composition is harder for people to wrap their brains
around.</li>
<li>I wish I had used inheritance in the case of an AuthTktAuthenticationPolicy
instead of composition because I would have had to answer fewer questions
about it.  Python programmers will always understand the mechanics of
inheritance better than whatever composition API you provide.</li>
</ul>
</div>
<div class="slide" id="first-do-no-harm">
<h1>#6: First, Do No Harm</h1>
<ul class="simple">
<li>Offering decorators that change the call signature of the function or
method they decorate.</li>
</ul>
</div>
<div class="slide" id="todo">
<h1>Todo</h1>
<ul class="simple">
<li>How convenience makes unit testing hard.</li>
<li>system testing vs unit testing, YAGNI/explicilt dependencies/quicker tests,
test_spam only needs the 'spambayes_score' config value, not your entire
django settings module (which you have to setup/clear after every test),
can't run those tests in parallel</li>
</ul>
</div>
</div>
</body>
</html>
